let array = [
  {
    id: "1",
    title:
      "외골격 제어행 보행훈련 로봇 엑소워크 (Exo-WALK) (주)알피오 AS 업체로 선정",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "2",
    title: "2021 혁신형 고령친화기업 집중육성 지원사업 알피오 선정 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "3",
    title: "치매예방에 좋은 음식 5가지 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "4",
    title: "노인장기요양보험 등급판정 기준 및 절차 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "5",
    title: "복지부, MMSE-DS 대체하는 치매선별검사도구 개발 추진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "6",
    title: "알피오 - 비지팅엔젤스코리아와 업무협약체결 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "7",
    title: "CoTras는 전국 약 800여곳에서 사용하고 있습니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "8",
    title: "COTRAS 후기를 올려주세요! 문화상품권을 드려요^^ ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "9",
    title: "KIMES 2021 부산 의료기기 전시회 행사사진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "10",
    title: "KIMES2021(키메스) 오는 3.18일~21일 알피오가 참석합니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "11",
    title:
      "외골격 제어행 보행훈련 로봇 엑소워크 (Exo-WALK) (주)알피오 AS 업체로 선정",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "12",
    title: "2021 혁신형 고령친화기업 집중육성 지원사업 알피오 선정 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "13",
    title: "치매예방에 좋은 음식 5가지 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "14",
    title: "노인장기요양보험 등급판정 기준 및 절차 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "15",
    title: "복지부, MMSE-DS 대체하는 치매선별검사도구 개발 추진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "16",
    title: "알피오 - 비지팅엔젤스코리아와 업무협약체결 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "17",
    title: "CoTras는 전국 약 800여곳에서 사용하고 있습니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "18",
    title: "COTRAS 후기를 올려주세요! 문화상품권을 드려요^^ ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "19",
    title: "KIMES 2021 부산 의료기기 전시회 행사사진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "20",
    title: "KIMES2021(키메스) 오는 3.18일~21일 알피오가 참석합니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "21",
    title:
      "외골격 제어행 보행훈련 로봇 엑소워크 (Exo-WALK) (주)알피오 AS 업체로 선정",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "22",
    title: "2021 혁신형 고령친화기업 집중육성 지원사업 알피오 선정 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "23",
    title: "치매예방에 좋은 음식 5가지 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "24",
    title: "노인장기요양보험 등급판정 기준 및 절차 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "25",
    title: "복지부, MMSE-DS 대체하는 치매선별검사도구 개발 추진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "26",
    title: "알피오 - 비지팅엔젤스코리아와 업무협약체결 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "27",
    title: "CoTras는 전국 약 800여곳에서 사용하고 있습니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "28",
    title: "COTRAS 후기를 올려주세요! 문화상품권을 드려요^^ ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "29",
    title: "KIMES 2021 부산 의료기기 전시회 행사사진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "30",
    title: "KIMES2021(키메스) 오는 3.18일~21일 알피오가 참석합니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "31",
    title:
      "외골격 제어행 보행훈련 로봇 엑소워크 (Exo-WALK) (주)알피오 AS 업체로 선정",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "32",
    title: "2021 혁신형 고령친화기업 집중육성 지원사업 알피오 선정 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "33",
    title: "치매예방에 좋은 음식 5가지 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "34",
    title: "노인장기요양보험 등급판정 기준 및 절차 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "35",
    title: "복지부, MMSE-DS 대체하는 치매선별검사도구 개발 추진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "36",
    title: "알피오 - 비지팅엔젤스코리아와 업무협약체결 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "37",
    title: "CoTras는 전국 약 800여곳에서 사용하고 있습니다! ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "38",
    title: "COTRAS 후기를 올려주세요! 문화상품권을 드려요^^ ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "39",
    title: "KIMES 2021 부산 의료기기 전시회 행사사진 ",
    date: "2021-11-03",
    check: "2682",
  },
  {
    id: "40",
    title: "KIMES2021(키메스) 오는 3.18일~21일 알피오가 참석합니다! ",
    date: "2021-11-03",
    check: "2682",
  },
];

console.log(array);
// show table data

function showTable(curArray) {
  document.getElementById("csTable").innerHTML = `
  <colgroup>
      <col class="col_10">
      <col class="col_70">
      <col class="col_10">
      <col class="col_10">
  </colgroup>  
  <thead class="fs18">
    <tr>
        <th>번호</th>
        <th>제목</th>
        <th>날짜</th>
        <th>조회</th>
    </tr>
  </thead>
  `;

  // for checking array is empty
  if (curArray == "") {
    document.getElementById("error").innerHTML = `<span>Not Found!</span>`;
  } else {
    document.getElementById("error").innerHTML = "";

    for (let i = 0; i < curArray.length; i++) {
      document.getElementById("csTable").innerHTML += `
      <tbody class="fs16">
        <tr>
          <td>${curArray[i].id}</td>
          <td>${curArray[i].title}</td>
          <td>${curArray[i].date}</td>
          <td>${curArray[i].check}</td>
        </tr>
      </tbody>  
      `;
    }
  }
}

// calling show table data method
showTable(array);

document.getElementById("searchInput").addEventListener("keyup", function () {
  let search = this.value.toLowerCase();

  newArray = array.filter(function (val) {
    if (
      val.id.includes(search) ||
      val.title.includes(search) ||
      val.date.includes(search) ||
      val.check.includes(search)
    ) {
      let newObj = {
        id: val.id,
        title: val.title,
        date: val.date,
        check: val.check,
      };
      return newObj;
    }
  });
  showTable(newArray);
});


let rowsPerPage = 10; // 한 페이지에 보여줄 아이템수
let rows = document.querySelectorAll("#csTable tbody tr");
let rowsCount = rows.length;
let pageCount = Math.ceil(rowsCount / rowsPerPage); // 소수점올려서 정수로 계산됨
let numbers = document.querySelector(".page_bar");

let prevPageBtn = document.querySelector(".csPagination .fa-arrow-left");
let nextPageBtn = document.querySelector(".csPagination .fa-arrow-right");
let pageActiveIdx = 0; // 현재 보고 있는 페이지 그룹 번호
let currentPageNum = 0; // 현재 보고 있는 페이지네이션 번호
let maxPageNum = 3; // 페이지그룹 최대개수

// 페이지네이션 생성
/*
let c = 대상.innerHTML
대상.innerHTML = <li><a href="#">1</a></li>
for(초기값;조건;증감)
*/

for (let i = 1; i <= pageCount; i++) {
  numbers.innerHTML += `<li><a href="#">${i}</a></li>`;
}
let numberBtn = numbers.querySelectorAll("li"); // 페이지 번호를 클릭하면 할일

// 페이지네이션 번호 감추기
for (nb of numberBtn) {
  nb.style.display = "none";
}

numberBtn.forEach((item, idx) => {
  item.addEventListener("click", (e) => {
    e.preventDefault();

    // 테이블 출력 함수
    displayRow(idx);
  });
});

//displayRow 할일
function displayRow(idx) {
  let start = idx * rowsPerPage;
  let end = start + rowsPerPage;
  // let rowsArray = Array.from(rows);  //Nodelist => array로 변환
  let rowsArray = [...rows];

  for (ra of rowsArray) {
    ra.style.display = "none";
  }

  let newRows = rowsArray.slice(start, end);
  for (nr of newRows) {
    nr.style.display = "";
  }

  for (nb of numberBtn) {
    nb.classList.remove("active");
  }
  numberBtn[idx].classList.add("active");
}

displayRow(0); // 시작하자마자 보여질 화면

// 페이지네이션 그룹표시 함수
function displayPage(num) {
  // 페이지네이션 번호 감추기
  for (nb of numberBtn) {
    nb.style.display = "none";
  }
  let totalPageCount = Math.ceil(pageCount / maxPageNum);

  let pageArr = [...numberBtn];
  let start = num * maxPageNum;
  let end = start + maxPageNum;
  let pageListArr = pageArr.slice(start, end);
  //console.log(pageArr);

  for (let item of pageListArr) {
    item.style.display = "";
  }
  // 이전버튼 보이기/안보이기
  if (pageActiveIdx == 0) {
    prevPageBtn.style.display = "none";
  } else {
    prevPageBtn.style.background = "#fd7e14";
    prevPageBtn.style.display = "";
  }
  // 마지막페이지 => next 버튼 안보이기
  if (pageActiveIdx == totalPageCount - 1) {
    nextPageBtn.style.display = "none";
  } else {
    nextPageBtn.style.background = "#fd7e14";
    nextPageBtn.style.display = "";
  }
}
displayPage(0);

nextPageBtn.addEventListener("click", () => {
  let nextPageNum = pageActiveIdx * maxPageNum + maxPageNum;
  displayRow(nextPageNum);
  ++pageActiveIdx;
  displayPage(pageActiveIdx);
});

prevPageBtn.addEventListener("click", () => {
  let nextPageNum = pageActiveIdx * maxPageNum - maxPageNum;
  displayRow(nextPageNum);
  --pageActiveIdx;
  displayPage(pageActiveIdx);
});
